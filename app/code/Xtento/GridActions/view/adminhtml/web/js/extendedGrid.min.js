/**
 * Copyright XTENTO GmbH & Co. KG / http://www.xtento.com
 */

define(['mageUtils', 'jquery'], function (utils, $) {
    'use strict';

    window.xtentoOnClickJs = function (element) {
        $(element).closest('td').prev().find('[type=checkbox]').prop('checked', false).click();
    };

    /**
     * Constructor
     * @param {Object} config
     * @constructor
     */
    function extendedGrid(config) {
    }

    /**
     * Custom bulk action callback required to send the additional inputs on the grid to our custom controller
     *
     * @param action
     * @param data
     */
    extendedGrid.prototype.bulkActionCallback = function (action, data) {
        var itemsType = data.excludeMode ? 'excluded' : 'selected',
            selections = {};

        selections[itemsType] = data[itemsType];

        if (!selections[itemsType].length) {
            selections[itemsType] = false;
        }

        _.extend(selections, data.params || {});

        // Get carriers selected in grid
        var carriers = [];
        $('.carrier-selector').each(function (index, element) {
            var carrierValue = $(element).val();
            if (carrierValue != 'custom') {
                carriers.push($(element).attr('rel') + '[|]' + carrierValue);
            }
        });

        // Get tracking numbers entered in grid
        var trackingnumbers = [];
        $('.tracking-input').each(function (index, element) {
            var trackingValue = $(element).val();
            if (trackingValue != '') {
                trackingnumbers.push($(element).attr('rel') + '[|]' + trackingValue);
            }
        });

        selections['trackingnumbers'] = trackingnumbers;
        selections['carriers'] = carriers;

        utils.submit({
            url: action.url,
            data: selections
        });
    };

    extendedGrid.prototype.initContainer = function () {
    };

    return extendedGrid;
});